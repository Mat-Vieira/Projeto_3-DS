<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notícias - Feed Principal</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 20px 0;
    }
    .container {
      width: 700px;
      margin: 0 auto 50px;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px 30px 30px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    .post {
      margin-bottom: 40px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 20px;
    }
    .post:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .post-title {
      font-size: 1.4rem;
      font-weight: bold;
      margin-bottom: 6px;
      color: #333;
    }
    .post-source {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 12px;
    }
    .post-link {
      color: #4CAF50;
      text-decoration: none;
      font-weight: bold;
    }
    .post-link:hover {
      color: #3e8e41;
      text-decoration: underline;
    }
    .comments-section {
      margin-top: 20px;
    }
    .comments-list {
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      background: #fafafa;
      font-size: 0.9rem;
      color: #333;
      margin-bottom: 10px;
    }
    .comments-list p {
      margin: 8px 0;
      word-wrap: break-word;
    }
    .comment-form {
      display: flex;
    }
    .comment-input {
      flex: 1;
      height: 36px;
      padding: 5px 10px;
      border: 1px solid #ccc;
      border-radius: 5px 0 0 5px;
      font-size: 1rem;
    }
    .comment-submit {
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 0 5px 5px 0;
      width: 90px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease;
      font-size: 1rem;
    }
    .comment-submit:hover {
      background-color: #3e8e41;
    }
    .login-info {
      font-size: 0.85rem;
      margin-bottom: 20px;
      color: #4CAF50;
      text-align: right;
    }
    .login-link {
      color: #4CAF50;
      text-decoration: none;
      font-weight: bold;
      cursor: pointer;
    }
    .login-link:hover {
      color: #3e8e41;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Feed de Notícias</h1>
    <div id="login-info" class="login-info"></div>
    <div id="posts"></div>
  </div>

  <script>
    // Simulated login state using localStorage
    function isLoggedIn() {
      return localStorage.getItem('loggedInUser') !== null;
    }

    function getLoggedInUser() {
      return localStorage.getItem('loggedInUser');
    }

    function redirectToLogin() {
      window.location.href = 'login.html';
    }

    // Simulated logout for testing (not visible in UI)
    // localStorage.removeItem('loggedInUser');

    // Sample posts data (simulate fetching from external news site like IGN)
    const posts = [
      {
        id: 'post1',
        title: 'Novo jogo incrível revelado na E3',
        source: 'IGN',
        url: 'https://www.ign.com/articles/new-game-reveal-e3',
      },
      {
        id: 'post2',
        title: 'Review: O jogo do ano que você não pode perder',
        source: 'IGN',
        url: 'https://www.ign.com/articles/game-review',
      },
      {
        id: 'post3',
        title: 'Atualização importante para o jogo popular',
        source: 'IGN',
        url: 'https://www.ign.com/articles/game-update',
      }
    ];

    const postsContainer = document.getElementById('posts');
    const loginInfo = document.getElementById('login-info');

    // Show login status or link
    function updateLoginInfo() {
      if (isLoggedIn()) {
        loginInfo.innerHTML = `Logado como <strong>${getLoggedInUser()}</strong> | <a href="#" id="logout-link" class="login-link">Sair</a>`;
        document.getElementById('logout-link').addEventListener('click', e => {
          e.preventDefault();
          localStorage.removeItem('loggedInUser');
          location.reload();
        });
      } else {
        loginInfo.innerHTML = `<a href="login.html" class="login-link">Entrar / Cadastrar</a>`;
      }
    }

    // Load comments from localStorage for a post
    function loadComments(postId) {
      const commentsKey = 'comments_' + postId;
      const commentsJSON = localStorage.getItem(commentsKey);
      return commentsJSON ? JSON.parse(commentsJSON) : [];
    }

    // Save comments to localStorage for a post
    function saveComments(postId, comments) {
      localStorage.setItem('comments_' + postId, JSON.stringify(comments));
    }

    // Render a single post with comments and comment form
    function renderPost(post) {
      const postDiv = document.createElement('div');
      postDiv.className = 'post';

      postDiv.innerHTML = `
        <div class="post-title">${post.title}</div>
        <div class="post-source">Fonte: ${post.source} - <a href="${post.url}" target="_blank" rel="noopener noreferrer" class="post-link">ver notícia completa</a></div>
        <div class="comments-section">
          <div class="comments-list" id="comments-list-${post.id}"></div>
          <form class="comment-form" id="comment-form-${post.id}">
            <input type="text" placeholder="Escreva um comentário..." class="comment-input" id="comment-input-${post.id}" autocomplete="off" />
            <button type="submit" class="comment-submit">Enviar</button>
          </form>
        </div>
      `;

      postsContainer.appendChild(postDiv);

      const commentsList = postDiv.querySelector(`#comments-list-${post.id}`);
      const commentForm = postDiv.querySelector(`#comment-form-${post.id}`);
      const commentInput = postDiv.querySelector(`#comment-input-${post.id}`);

      function updateCommentsUI() {
        const comments = loadComments(post.id);
        commentsList.innerHTML = '';
        if (comments.length === 0) {
          commentsList.innerHTML = '<p>Nenhum comentário ainda.</p>';
        } else {
          comments.forEach(c => {
            const p = document.createElement('p');
            p.textContent = `${c.user}: ${c.text}`;
            commentsList.appendChild(p);
          });
        }
        commentsList.scrollTop = commentsList.scrollHeight;
      }

      // On typing or focus, check login status: redirect if not logged in
      commentInput.addEventListener('focus', () => {
        if (!isLoggedIn()) {
          alert('Você precisa estar logado para comentar.');
          redirectToLogin();
        }
      });

      commentForm.addEventListener('submit', (e) => {
        e.preventDefault();
        if (!isLoggedIn()) {
          alert('Você precisa estar logado para comentar.');
          redirectToLogin();
          return;
        }
        const text = commentInput.value.trim();
        if (text.length === 0) {
          return;
        }
        const comments = loadComments(post.id);
        comments.push({ user: getLoggedInUser(), text });
        saveComments(post.id, comments);
        commentInput.value = '';
        updateCommentsUI();
      });

      updateCommentsUI();
    }

    // Initialize page
    updateLoginInfo();
    posts.forEach(renderPost);
  </script>
</body>
</html>
